<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Status Control</title>
    <link rel="stylesheet" href="/public/session/style-new.css">
    <!-- Backup: <link rel="stylesheet" href="./style.css"> -->
    <!-- QR Code and AprilTag libraries for mobile linking -->
    <script src="/public/vendor/qrcode.min.js"></script>
    <script src="/public/vendor/jsQR.js"></script>
    <script src="/public/js/utils/apriltag.js"></script>
    <script defer type="module" src="/public/session/script.js"></script>
</head>
<body>

    <div id="sessionStatusModal" class="modal-overlay active">
        <div class="modal-content">
            
            <div class="modal-header" id="sessionHeader">
                <h2>üõ°Ô∏è Session Details</h2>
                <button class="close-btn" data-close-modal>‚àí</button>
            </div>
            
            <div class="modal-body" id="sessionBody">

            <!-- Overview Section - 3 Columns -->
            <div class="overview-section">
                <div class="overview-column status-column">
                    <h3>Status</h3>
                    <div class="status-item">
                        <span class="label">Binding State:</span>
                        <strong class="value" id="bindingState">Bound</strong>
                    </div>
                    <div class="status-item">
                        <span class="label">Risk Signals:</span>
                        <div class="status-flag-container">
                            <strong class="value status-flag" id="sessionFlag">GREEN</strong>
                            <button class="inspector-btn" id="inspectRiskSignals" title="Inspect Signal Data">
                                <svg xmlns="http://www.w3.org/2000/svg" height="18px" viewBox="0 -960 960 960" width="18px">
                                    <path d="M440-280h80v-240h-80v240Zm40-320q17 0 28.5-11.5T520-640q0-17-11.5-28.5T480-680q-17 0-28.5 11.5T440-640q0 17 11.5 28.5T480-600Zm0 520q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="status-item">
                        <span class="label">Active Sessions:</span>
                        <div class="session-count-container">
                            <strong class="value" id="sessionCount">1</strong>
                        </div>
                    </div>
                    <div class="status-item">
                        <span class="label">Auth Method:</span>
                        <strong class="value" id="authMethod">No value</strong>
                    </div>
                </div>

                <div class="overview-column timers-column">
                    <h3>Timers</h3>
                    <div class="timer-item">
                        <span class="label">Session Expires:</span>
                        <strong id="sessionTimer" class="time-value">00:00</strong>
                    </div>
                    <div class="timer-item">
                        <span class="label">Idle Timeout:</span>
                        <strong id="idleTimer" class="time-value">15:00</strong>
                    </div>
                </div>

                <div class="overview-column controls-column">
                    <h3>Authentication</h3>
                    <div class="username-input-container">
                        <label for="usernameInput">Username:</label>
                        <div class="username-input-group">
                            <input type="text" id="usernameInput" placeholder="Enter username" autocomplete="username">
                            <button class="check-username-btn" id="checkUsernameBtn" disabled>
                                <span class="btn-text">Go</span>
                            </button>
                        </div>
                    </div>
                    <button class="control-btn auth-btn passkey-btn" id="passkeyAuthBtn" disabled>
                        <span class="btn-icon">üîë</span>
                        <span class="btn-text">Checking...</span>
                    </button>
                    <button class="control-btn auth-btn mobile-btn" id="mobileLinkBtn" disabled>
                        <span class="btn-icon">üì±</span>
                        <span class="btn-text">Link Mobile Device</span>
                    </button>
                </div>
            </div>

            <!-- Session History Section -->
            <div class="session-history-section" id="sessionHistorySection" style="display: none;">
                <div class="section-header">
                    <div class="section-title">
                        <h3>Session History</h3>
                    </div>
                    <div class="section-actions">
                    </div>
                </div>
                <div id="sessionHistoryList" class="session-history-list">
                    <p class="no-history">No previous sessions</p>
                </div>
            </div>

            <!-- Devices Section -->
            <div class="devices-section" id="devicesSection" style="display: none;">
                <div class="section-header">
                    <div class="section-title">
                        <h3>Registered Devices</h3>
                    </div>
                </div>
                <div id="devicesList" class="devices-list">
                    <p class="no-devices">No registered devices</p>
                </div>
            </div>

            <!-- Session Details Modal (hidden by default) -->
            <div id="sessionDetailsModal" class="modal-overlay" style="display: none;">
                <div class="modal-content session-details-content">
                    <div class="modal-header">
                        <h2>Active Sessions</h2>
                        <button class="close-btn" data-close-session-details>&times;</button>
                    </div>
                    <div class="sessions-list" id="sessionsList">
                        <!-- Sessions will be populated here -->
                    </div>
                </div>
            </div>

            
            </div> <!-- End modal-body -->
        </div>
    </div>

    <!-- Templates -->
    <template id="historyItemTemplate">
        <div class="history-session-item">
            <div class="history-main">
                <div class="history-header">
                    <span class="history-time" data-time></span>
                    <div class="history-status-method">
                        <span class="history-status" data-status></span>
                        <span class="history-method" data-method></span>
                    </div>
                </div>
                <div class="history-details">
                    <span class="history-location" data-location></span>
                </div>
                <div class="history-linked" data-linked style="display: none;">
                    <span class="linked-icon">üîó</span>
                    <span class="linked-text" data-linked-text></span>
                </div>
                <div class="history-signal" data-signal style="display: none;">
                    <button class="history-action-btn signal-data-btn" data-signal-link>More Signal Data</button>
                </div>
            </div>
            <div class="history-actions" data-actions>
                <button class="history-action-btn report-btn" data-report-btn>Report Suspicious Activity</button>
                <button class="history-action-btn kill-btn" data-kill-btn style="display: none;">Kill Session</button>
            </div>
        </div>
    </template>

    <template id="mobileLinkingModalTemplate">
        <div class="modal-overlay" id="mobileLinkingModal">
            <div class="modal-content mobile-linking-content">
                <div class="modal-header">
                    <h2>Link Mobile Device</h2>
                    <button class="close-btn" id="closeMobileLinkBtn">&times;</button>
                </div>
                <div class="modal-body" id="mobileLinkingModalContent">
                    <!-- Mobile linking UI will be rendered here -->
                </div>
            </div>
        </div>
    </template>

    <template id="signalDataModalTemplate">
        <div class="modal-overlay" id="signalDataModal">
            <div class="modal-content signal-data-content">
                <div class="modal-header">
                    <h2>Session Signal Data</h2>
                    <button class="close-btn" id="closeSignalDataBtn">&times;</button>
                </div>
                <div class="modal-body" id="signalDataModalContent">
                    <!-- Signal data will be rendered here -->
                </div>
            </div>
        </div>
    </template>

    <template id="sessionItemTemplate">
        <div class="session-item">
            <div class="session-info">
                <div class="session-header">
                    <span class="session-location" data-location></span>
                    <span class="session-browser" data-browser></span>
                    <span class="current-badge" data-current-badge style="display: none;">Current</span>
                </div>
                <div class="session-details">
                    <span class="session-ip" data-ip></span>
                    <span class="session-activity" data-activity></span>
                </div>
            </div>
            <div class="session-actions" data-actions>
                <button class="action-btn signal-data-btn" data-signal-link>More Signal Data</button>
                <button class="action-btn terminate-btn" data-terminate-btn>Terminate</button>
                <button class="action-btn report-btn" data-report-btn>Report</button>
            </div>
        </div>
    </template>

    <template id="deviceItemTemplate">
        <div class="device-item">
            <div class="device-main">
                <div class="device-header">
                    <span class="device-type-icon" data-type-icon></span>
                    <div class="device-info">
                        <span class="device-type" data-type></span>
                        <span class="device-id-short" data-id-short></span>
                    </div>
                    <span class="device-current-badge" data-current-device style="display: none;">Current</span>
                </div>
                <div class="device-details">
                    <span class="device-last-used" data-last-used></span>
                    <span class="device-sessions" data-sessions></span>
                </div>
                <div class="device-signal" data-device-signal></div>
            </div>
            <div class="device-actions" data-device-actions>
                <button class="device-action-btn remove-btn" data-remove-btn>Remove Device</button>
            </div>
        </div>
    </template>

</body>
</html>