<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Session Status Control</title>
    <link rel="stylesheet" href="/public/session/style-new.css">
    <!-- Backup: <link rel="stylesheet" href="./style.css"> -->
    <!-- QR Code and AprilTag libraries for mobile linking -->
    <script src="/public/vendor/qrcode.min.js"></script>
    <script src="/public/vendor/jsQR.js"></script>
    <script src="/public/js/utils/apriltag.js"></script>
    <script defer type="module" src="/public/session/script.js"></script>
</head>
<body>

    <div id="sessionStatusModal" class="modal-overlay active">
        <div class="modal-content">
            
            <div class="modal-header" id="sessionHeader">
                <h2>üõ°Ô∏è Session Details</h2>
                <div style="display: flex; align-items: center; gap: 10px;">
                    <button class="close-btn" data-close-modal>‚àí</button>
                </div>
            </div>
            
            <div class="modal-body" id="sessionBody">

            <!-- Overview Section - 2 Columns -->
            <div class="overview-section">
                <!-- Left Column: Status & Timers (2/3 width) -->
                <div class="overview-left-column">
                    <!-- Status Section -->
                    <div class="overview-column status-column">
                        <h3>Current Session</h3>
                        <div class="status-item">
                            <span class="label">Binding State:</span>
                            <strong class="value" id="bindingState">Bound</strong>
                        </div>
                        <div class="status-item">
                            <span class="label">Location:</span>
                            <strong class="value" id="currentLocation">Unknown</strong>
                        </div>
                        <div class="status-item">
                            <span class="label">Browser:</span>
                            <strong class="value" id="currentBrowser">Unknown</strong>
                        </div>
                        <div class="status-item">
                            <span class="label">Platform:</span>
                            <strong class="value" id="currentPlatform">Unknown</strong>
                        </div>
                        <div class="status-item">
                            <span class="label">Active Sessions:</span>
                            <div class="session-count-container">
                                <strong class="value" id="sessionCount">1</strong>
                            </div>
                        </div>
                    </div>

                    <!-- Timers Section -->
                    <div class="overview-column timers-column">
                        <h3>Timers</h3>
                        <div class="timers-row">
                            <div class="timer-item">
                                <span class="label">Session Expires:</span>
                                <strong id="sessionTimer" class="time-value">00:00</strong>
                            </div>
                            <div class="timer-item">
                                <span class="label">Idle Timeout:</span>
                                <strong id="idleTimer" class="time-value">15:00</strong>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Authentication (1/3 width) -->
                <div class="overview-column controls-column">
                    <h3>Authentication</h3>
                    <div class="username-input-container">
                        <label for="usernameInput">Username:</label>
                        <div class="username-input-group">
                            <input type="text" id="usernameInput" placeholder="Enter username" autocomplete="username">
                            <button class="check-username-btn" id="checkUsernameBtn" disabled>
                                <span class="btn-text">Go</span>
                            </button>
                        </div>
                    </div>
                    <button class="control-btn auth-btn passkey-btn" id="passkeyAuthBtn" disabled>
                        <span class="btn-icon">üîë</span>
                        <span class="btn-text">Checking...</span>
                    </button>
                    <button class="control-btn auth-btn mobile-btn" id="mobileLinkBtn" disabled>
                        <span class="btn-icon">üì±</span>
                        <span class="btn-text">Link Mobile Device</span>
                    </button>
                </div>
            </div>

            <!-- Session History Section -->
            <div class="session-history-section" id="sessionHistorySection" style="display: none;">
                <div class="section-header">
                    <div class="section-title">
                        <h3>Session History</h3>
                    </div>
                    <div class="section-actions">
                    </div>
                </div>
                <div id="sessionHistoryList" class="session-history-list">
                    <p class="no-history">No previous sessions</p>
                </div>
            </div>

            <!-- Devices Section -->
            <div class="devices-section" id="devicesSection" style="display: none;">
                <div class="section-header">
                    <div class="section-title">
                        <h3>Registered Devices</h3>
                    </div>
                </div>
                <div id="devicesList" class="devices-list">
                    <p class="no-devices">No registered devices</p>
                </div>
            </div>

            <!-- Credentials Section -->
            <div class="credentials-section" id="credentialsSection" style="display: none;">
                <div class="section-header">
                    <div class="section-title">
                        <h3>Credentials</h3>
                    </div>
                </div>
                <div id="credentialsList" class="credentials-list">
                    <p class="no-credentials">No passkey credentials</p>
                </div>
            </div>

            <!-- Session Details Modal (hidden by default) -->
            <div id="sessionDetailsModal" class="modal-overlay" style="display: none;">
                <div class="modal-content session-details-content">
                    <div class="modal-header">
                        <h2>Active Sessions</h2>
                        <button class="close-btn" data-close-session-details>&times;</button>
                    </div>
                    <div class="sessions-list" id="sessionsList">
                        <!-- Sessions will be populated here -->
                    </div>
                </div>
            </div>

            
            </div> <!-- End modal-body -->
        </div>
    </div>

    <!-- Templates -->
    <template id="historyItemTemplate">
        <div class="history-session-item">
            <div class="history-main">
                <div class="history-header">
                    <span class="history-device-icon" data-device-icon></span>
                    <span class="history-time" data-time></span>
                    <div class="history-status-method">
                        <span class="history-status" data-status></span>
                        <span class="history-method" data-method></span>
                    </div>
                </div>
                <div class="history-details">
                    <span class="history-location" data-location></span>
                </div>
                <div class="history-flag-comment" data-flag-comment style="display: none;">
                    <span class="flag-comment-text" data-flag-comment-text></span>
                </div>
                <div class="history-linked" data-linked style="display: none;">
                    <span class="linked-icon">üîó</span>
                    <span class="linked-text" data-linked-text></span>
                </div>
                <div class="history-signal" data-signal style="display: none;">
                    <span class="history-risk-flag" data-risk-flag></span>
                    <button class="history-action-btn signal-data-btn" data-signal-link>Details</button>
                </div>
            </div>
            <div class="history-actions" data-actions>
                <button class="history-action-btn acknowledge-btn" data-acknowledge-btn style="display: none;">‚úì This is me</button>
                <button class="history-action-btn report-btn" data-report-btn>Report</button>
                <button class="history-action-btn kill-btn" data-kill-btn style="display: none;">Kill Session</button>
            </div>
        </div>
    </template>

    <template id="mobileLinkingModalTemplate">
        <div class="modal-overlay" id="mobileLinkingModal">
            <div class="modal-content mobile-linking-content">
                <div class="modal-header">
                    <h2>Link Mobile Device</h2>
                    <button class="close-btn" id="closeMobileLinkBtn">&times;</button>
                </div>
                <div class="modal-body" id="mobileLinkingModalContent">
                    <!-- Mobile linking UI will be rendered here -->
                </div>
            </div>
        </div>
    </template>

    <template id="signalDataModalTemplate">
        <div class="modal-overlay" id="signalDataModal">
            <div class="modal-content signal-data-content">
                <div class="modal-header">
                    <h2>Session Signal Data</h2>
                    <button class="close-btn" id="closeSignalDataBtn">&times;</button>
                </div>
                <div class="modal-body" id="signalDataModalContent">
                    <!-- Signal data will be rendered here -->
                </div>
            </div>
        </div>
    </template>

    <template id="sessionItemTemplate">
        <div class="session-item">
            <div class="session-info">
                <div class="session-header">
                    <span class="session-risk-flag" data-risk-flag style="display: none;"></span>
                    <span class="session-location" data-location></span>
                    <span class="session-browser" data-browser></span>
                    <span class="current-badge" data-current-badge style="display: none;">Current</span>
                </div>
                <div class="session-details">
                    <span class="session-ip" data-ip></span>
                    <span class="session-activity" data-activity></span>
                    <span class="session-flag-comment" data-flag-comment style="display: none;"></span>
                </div>
            </div>
            <div class="session-actions" data-actions>
                <button class="action-btn acknowledge-session-btn" data-acknowledge-btn style="display: none;">‚úì This is me</button>
                <button class="action-btn signal-data-btn" data-signal-link>Details</button>
                <button class="action-btn terminate-btn" data-terminate-btn>Terminate</button>
                <button class="action-btn report-btn" data-report-btn>Report</button>
            </div>
        </div>
    </template>

    <template id="deviceItemTemplate">
        <div class="device-item">
            <div class="device-main">
                <div class="device-header">
                    <span class="device-type-icon" data-type-icon></span>
                    <div class="device-info">
                        <span class="device-type" data-type></span>
                        <span class="device-id-short" data-id-short></span>
                    </div>
                    <span class="device-current-badge" data-current-device style="display: none;">Current</span>
                </div>
                <div class="device-details">
                    <span class="device-last-used" data-last-used></span>
                    <span class="device-sessions" data-sessions></span>
                    <span class="device-bound-user" data-bound-user style="display: none;"></span>
                </div>
                <div class="device-signal" data-device-signal></div>
            </div>
            <div class="device-actions" data-device-actions>
                <button class="device-action-btn remove-btn" data-remove-btn>Remove Device</button>
            </div>
        </div>
    </template>

    <template id="credentialItemTemplate">
        <div class="credential-item">
            <div class="credential-main">
                <div class="credential-header">
                    <span class="credential-icon" data-cred-icon></span>
                    <div class="credential-info">
                        <span class="credential-type" data-cred-device-type></span>
                        <span class="credential-id-short" data-cred-id-short></span>
                    </div>
                </div>
                <div class="credential-details">
                    <span class="credential-created" data-cred-created></span>
                    <span class="credential-sign-count" data-sign-count></span>
                </div>
            </div>
            <div class="credential-actions">
                <button class="credential-action-btn remove-btn" data-remove-cred-btn>Remove Passkey</button>
            </div>
        </div>
    </template>

    <!-- SSE Notification Modal -->
    <div id="notificationModal" class="notification-modal">
        <div class="notification-content">
            <div class="notification-header">
                <h3>‚ö†Ô∏è Security Alert</h3>
                <button class="notification-close">&times;</button>
            </div>
            <div class="notification-body">
                <p class="notification-message"></p>
                <div class="notification-meta">
                    <span class="notification-time"></span>
                </div>
            </div>
        </div>
    </div>

</body>
</html>